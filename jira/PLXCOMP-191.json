{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"130020","self":"http://jira.codehaus.org/rest/api/latest/issue/130020","key":"PLXCOMP-191","fields":{"progress":{"progress":0,"total":0},"summary":"PlexusArchiver tries to open maven project target/classes directory as a ZipFile when creating jar index entries","timetracking":{"originalEstimate":"0m","remainingEstimate":"0m","originalEstimateSeconds":0,"remainingEstimateSeconds":0},"issuetype":{"self":"http://jira.codehaus.org/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"http://jira.codehaus.org/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"customfield_10110":null,"votes":{"self":"http://jira.codehaus.org/rest/api/2/issue/PLXCOMP-191/votes","votes":0,"hasVoted":false},"resolution":{"self":"http://jira.codehaus.org/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"fixVersions":[{"self":"http://jira.codehaus.org/rest/api/2/version/18270","id":"18270","name":"plexus-archiver-2.0.2","archived":false,"released":true,"releaseDate":"2012-01-14"}],"resolutiondate":"2012-01-09T00:55:58.565-0600","customfield_10210":"1.0","timespent":null,"reporter":{"self":"http://jira.codehaus.org/rest/api/2/user?username=bobfields","name":"bobfields","emailAddress":"bobfieldsfb@hotmail.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=bobfields&avatarId=11722","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=bobfields&avatarId=11722","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=bobfields&avatarId=11722","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=bobfields&avatarId=11722"},"displayName":"Bob Fields","active":true},"aggregatetimeoriginalestimate":0,"customfield_10161":["bobfields(bobfields)","krosenvold(krosenvold)"],"customfield_10160":null,"updated":"2012-01-09T00:58:31.991-0600","created":"2011-09-29T16:49:46.203-0500","description":"Creating jar artifact index (default=true) from the maven-jar-plugin tries to open the project /target/classes as a Jar artifact. This patch verifies that the zip file exists and is not a directory, and puts out an error message. I also fixed a bunch of eclipse compiler warnings in the JarArchiver.java file at the same time, but the main changes are in grabFilesAndDirs:\r\n        File zipFile = new File(file);\r\n        if (!zipFile.exists())\r\n        {\r\n            // Need static method reference, AbstractAcrhiver.logger is instance variable\r\n            Logger logger = new ConsoleLogger( Logger.LEVEL_INFO, \"console\" );\r\n            logger.error(\"JarArchiver.grabFilesAndDirs file does not exist: \" + zipFile.getAbsolutePath());\r\n        }\r\n        else if (zipFile.isDirectory())\r\n        {\r\n            // Need static method reference, AbstractAcrhiver.logger is instance variable\r\n            Logger logger = new ConsoleLogger( Logger.LEVEL_INFO, \"console\" );\r\n            logger.error(\"JarArchiver.grabFilesAndDirs file is a directory: \" + zipFile.getAbsolutePath());\r\n        }\r\n        else\r\n        {\r\n....The rest of the existing method.\r\n\r\nThe error stack trace:\r\nCaused by: org.apache.maven.plugin.MojoExecutionException: Error assembling JAR\r\n\tat org.apache.maven.plugin.jar.AbstractJarMojo.createArchive(AbstractJarMojo.java:223)\r\n\tat org.apache.maven.plugin.jar.AbstractJarMojo.execute(AbstractJarMojo.java:235)\r\n\tat org.apache.maven.plugin.DefaultBuildPluginManager.executeMojo(DefaultBuildPluginManager.java:101)\r\n\tat org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:209)\r\n\t... 19 more\r\nCaused by: org.codehaus.plexus.archiver.ArchiverException: Problem creating jar: C:\\Workspaces\\A34\\H2\\h2\\target\\classes (Access is denied)\r\n\tat org.codehaus.plexus.archiver.AbstractArchiver.createArchive(AbstractArchiver.java:892)\r\n\tat org.apache.maven.archiver.MavenArchiver.createArchive(MavenArchiver.java:543)\r\n\tat org.apache.maven.plugin.jar.AbstractJarMojo.createArchive(AbstractJarMojo.java:216)\r\n\t... 22 more\r\nCaused by: java.io.FileNotFoundException: C:\\Workspaces\\A34\\H2\\h2\\target\\classes (Access is denied)\r\n\tat java.io.RandomAccessFile.open(Native Method)\r\n\tat java.io.RandomAccessFile.<init>(RandomAccessFile.java:212)\r\n\tat org.codehaus.plexus.archiver.zip.ZipFile.<init>(ZipFile.java:150)\r\n\tat org.codehaus.plexus.archiver.zip.ZipFile.<init>(ZipFile.java:135)\r\n\tat org.codehaus.plexus.archiver.jar.JarArchiver.grabFilesAndDirs(JarArchiver.java:781)\r\n\tat org.codehaus.plexus.archiver.jar.JarArchiver.createIndexList(JarArchiver.java:449)\r\n\tat org.codehaus.plexus.archiver.jar.JarArchiver.finalizeZipOutputStream(JarArchiver.java:376)\r\n\tat org.codehaus.plexus.archiver.zip.AbstractZipArchiver.execute(AbstractZipArchiver.java:214)\r\n\tat org.codehaus.plexus.archiver.AbstractArchiver.createArchive(AbstractArchiver.java:875)\r\n\r\nI don't have a unit test because I don't really know why this error occurs in the first place. The call from maven-jar-plugin to plexus-archiver is done with the correct parameters (jar file name to be created from a local directory). The error only occurs in one project that I have, I see nothing wrong with the project configuration. I just know that this fixes the problem, and the additional error checking will not hurt anything because it should never hit that code unless some very unusual circumstances exist.\r\n\r\nThis is a minor issue because it only happens on some projects, and the maven-jar-plugin can be configured to not create an index by\r\n            <plugin>\r\n                <artifactId>maven-jar-plugin</artifactId>\r\n                <version>2.4-SNAPSHOT</version>\r\n                <configuration>\r\n                    <archive>\r\n                        <!-- default true: java.io.FileNotFoundException: ...\\target (Access is denied) in org.codehaus.plexus.archiver.jar.JarArchiver.createIndexList(JarArchiver.java:449) -->\r\n                        <index>false</index>\r\n....\r\n                    </archive>\r\n                </configuration>\r\n            </plugin>\r\n\r\nHowever, creating an archive index is the default behavior, something that is typically not turned off.","priority":{"self":"http://jira.codehaus.org/rest/api/2/priority/4","iconUrl":"http://jira.codehaus.org/images/icons/priorities/minor.png","name":"Minor","id":"4"},"duedate":null,"issuelinks":[],"customfield_10163":"95212800","watches":{"self":"http://jira.codehaus.org/rest/api/2/issue/PLXCOMP-191/watchers","watchCount":1,"isWatching":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"subtasks":[],"status":{"self":"http://jira.codehaus.org/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"http://jira.codehaus.org/images/icons/statuses/closed.png","name":"Closed","id":"6"},"customfield_10090":null,"labels":[],"workratio":0,"assignee":{"self":"http://jira.codehaus.org/rest/api/2/user?username=krosenvold","name":"krosenvold","emailAddress":"krosenvold@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=krosenvold&avatarId=11127","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=krosenvold&avatarId=11127","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=krosenvold&avatarId=11127","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=krosenvold&avatarId=11127"},"displayName":"Kristian Rosenvold","active":true},"attachment":[{"self":"http://jira.codehaus.org/rest/api/2/attachment/57079","id":"57079","filename":"Fix-JarArchiver-exception-when-creating-an-index-fil.patch","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=bobfields","name":"bobfields","emailAddress":"bobfieldsfb@hotmail.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=bobfields&avatarId=11722","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=bobfields&avatarId=11722","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=bobfields&avatarId=11722","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=bobfields&avatarId=11722"},"displayName":"Bob Fields","active":true},"created":"2011-09-29T16:49:46.400-0500","size":31995,"mimeType":"text/plain","content":"http://jira.codehaus.org/secure/attachment/57079/Fix-JarArchiver-exception-when-creating-an-index-fil.patch"}],"customfield_10221":null,"customfield_10220":null,"customfield_10200":null,"aggregatetimeestimate":0,"customfield_10190":null,"project":{"self":"http://jira.codehaus.org/rest/api/2/project/11440","id":"11440","key":"PLXCOMP","name":"Plexus Components","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/projectavatar?size=xsmall&pid=11440&avatarId=10011","24x24":"http://jira.codehaus.org/secure/projectavatar?size=small&pid=11440&avatarId=10011","32x32":"http://jira.codehaus.org/secure/projectavatar?size=medium&pid=11440&avatarId=10011","48x48":"http://jira.codehaus.org/secure/projectavatar?pid=11440&avatarId=10011"},"projectCategory":{"self":"http://jira.codehaus.org/rest/api/2/projectCategory/10003","id":"10003","description":"various containers","name":"containers"}},"versions":[{"self":"http://jira.codehaus.org/rest/api/2/version/17455","id":"17455","description":"","name":"plexus-archiver-2.0","archived":false,"released":true,"releaseDate":"2011-06-27"}],"customfield_10170":[{"self":"http://jira.codehaus.org/rest/api/2/customFieldOption/10070","value":"Yes","id":"10070"}],"environment":"JDK6. maven-jar-plugin 2.4-SNAPSHOT. Maven 3.0.3.","timeestimate":0,"customfield_10130":null,"aggregateprogress":{"progress":0,"total":0},"lastViewed":null,"components":[{"self":"http://jira.codehaus.org/rest/api/2/component/12540","id":"12540","name":"plexus-archiver"}],"comment":{"startAt":0,"maxResults":1,"total":1,"comments":[{"self":"http://jira.codehaus.org/rest/api/2/issue/130020/comment/287773","id":"287773","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=krosenvold","name":"krosenvold","emailAddress":"krosenvold@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=krosenvold&avatarId=11127","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=krosenvold&avatarId=11127","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=krosenvold&avatarId=11127","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=krosenvold&avatarId=11127"},"displayName":"Kristian Rosenvold","active":true},"body":"Fixed in fd52877126cda758d9fd4009ae24a5ef8416cd85.\r\n\r\nPlease do not mix patches and \"formatting\" related stuff in the same patch, make 2 different ones.\r\n\r\nYour patch was also broken (it included some changes from a different commit on trunk), so I applied this manually. When the patch additionally contains lots of formatting changes, you need great luck to have it applied ;)","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=krosenvold","name":"krosenvold","emailAddress":"krosenvold@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=krosenvold&avatarId=11127","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=krosenvold&avatarId=11127","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=krosenvold&avatarId=11127","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=krosenvold&avatarId=11127"},"displayName":"Kristian Rosenvold","active":true},"created":"2012-01-09T00:55:58.673-0600","updated":"2012-01-09T00:58:31.987-0600"}]},"timeoriginalestimate":0,"aggregatetimespent":null}}