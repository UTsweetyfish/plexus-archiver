{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"118942","self":"http://jira.codehaus.org/rest/api/latest/issue/118942","key":"PLXCOMP-167","fields":{"progress":{"progress":0,"total":0},"summary":"Archiver/PlexusIoResourceAttributeUtils ls performance","timetracking":{},"issuetype":{"self":"http://jira.codehaus.org/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"http://jira.codehaus.org/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false},"customfield_10110":null,"votes":{"self":"http://jira.codehaus.org/rest/api/2/issue/PLXCOMP-167/votes","votes":0,"hasVoted":false},"resolution":{"self":"http://jira.codehaus.org/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"fixVersions":[],"resolutiondate":"2011-06-27T15:46:59.675-0500","customfield_10210":"0.0","timespent":null,"reporter":{"self":"http://jira.codehaus.org/rest/api/2/user?username=t_kurki","name":"t_kurki","emailAddress":"teppo.kurki@reaktor.fi","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Teppo Kurki","active":true},"aggregatetimeoriginalestimate":null,"customfield_10161":["krosenvold(krosenvold)","t_kurki(t_kurki)"],"customfield_10160":null,"updated":"2011-06-27T15:46:59.758-0500","created":"2010-12-08T14:46:02.347-0600","description":"Maven package tasks that use plexus-archiver 1.0/1.2 suffer from performance hit caused by PlexusIoResourceAttributeUtils' usage of native ls command for getting file attributes.\r\n\r\n","priority":{"self":"http://jira.codehaus.org/rest/api/2/priority/4","iconUrl":"http://jira.codehaus.org/images/icons/priorities/minor.png","name":"Minor","id":"4"},"duedate":null,"issuelinks":[],"customfield_10163":"112060800","watches":{"self":"http://jira.codehaus.org/rest/api/2/issue/PLXCOMP-167/watchers","watchCount":0,"isWatching":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"subtasks":[],"status":{"self":"http://jira.codehaus.org/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"http://jira.codehaus.org/images/icons/statuses/closed.png","name":"Closed","id":"6"},"customfield_10090":null,"labels":[],"workratio":-1,"assignee":{"self":"http://jira.codehaus.org/rest/api/2/user?username=krosenvold","name":"krosenvold","emailAddress":"krosenvold@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=krosenvold&avatarId=11127","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=krosenvold&avatarId=11127","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=krosenvold&avatarId=11127","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=krosenvold&avatarId=11127"},"displayName":"Kristian Rosenvold","active":true},"attachment":[],"customfield_10221":null,"customfield_10220":null,"customfield_10200":null,"aggregatetimeestimate":null,"customfield_10190":null,"project":{"self":"http://jira.codehaus.org/rest/api/2/project/11440","id":"11440","key":"PLXCOMP","name":"Plexus Components","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/projectavatar?size=xsmall&pid=11440&avatarId=10011","24x24":"http://jira.codehaus.org/secure/projectavatar?size=small&pid=11440&avatarId=10011","32x32":"http://jira.codehaus.org/secure/projectavatar?size=medium&pid=11440&avatarId=10011","48x48":"http://jira.codehaus.org/secure/projectavatar?pid=11440&avatarId=10011"},"projectCategory":{"self":"http://jira.codehaus.org/rest/api/2/projectCategory/10003","id":"10003","description":"various containers","name":"containers"}},"versions":[],"customfield_10170":null,"environment":"Maven 3.0.1 \r\norg.apache.maven.plugins:maven-jar-plugin:jar:2.3.1:\r\n    org.codehaus.plexus:plexus-archiver:jar:1.0:compile\r\n      org.codehaus.plexus:plexus-io:jar:1.0:compile\r\n\r\n org.apache.maven.plugins:maven-war-plugin:jar:2.1.1:\r\n    org.apache.maven:maven-archiver:jar:2.4.1:compile\r\n    org.codehaus.plexus:plexus-archiver:jar:1.2:compile\r\n       org.codehaus.plexus:plexus-io:jar:1.0.1:compile","timeestimate":null,"customfield_10130":null,"aggregateprogress":{"progress":0,"total":0},"lastViewed":null,"components":[{"self":"http://jira.codehaus.org/rest/api/2/component/12540","id":"12540","name":"plexus-archiver"},{"self":"http://jira.codehaus.org/rest/api/2/component/14319","id":"14319","name":"plexus-io"}],"comment":{"startAt":0,"maxResults":2,"total":2,"comments":[{"self":"http://jira.codehaus.org/rest/api/2/issue/118942/comment/246927","id":"246927","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=t_kurki","name":"t_kurki","emailAddress":"teppo.kurki@reaktor.fi","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Teppo Kurki","active":true},"body":"I was profiling Maven package tasks and stumbled upon a bottleneck in forking native ls commands to dig up file attributes in PlexusIoResourceAttributeUtils.\r\n\r\nBy hacking a system property override in PlexusIoResourceAttributeUtils.enabledOnCurrentOperatingSystem to disable the forked 'ls' calls (apparently the whole feature is not available on Windows) I was able to get about 30% decrease in mvn package task runtimes. \r\n\r\nSimple way to test this is to run mvn package (be sure to compile & test first) on http://svn.codehaus.org/plexus/plexus-components/trunk. I am getting consistent runtimes of around 4.8 seconds with ls attribute fetch disabled and 8.4 seconds with vanilla configuration. \r\n\r\nOn a much larger project, which produces 220 different jars, the difference is 3:18s to 4:38s, which is pretty considerable if you need to have CI spit out snapshots asap. The package task called 'ls' about 1500 times during the package run.\r\n\r\n(One) stacktrace to the ls fork in question is \r\n{code}\r\nPlexusIoResourceAttributeUtils.executeLs(File, String, PlexusIoResourceAttributeUtils$LoggerStreamConsumer, StreamConsumer, Logger) line: 286\r\nPlexusIoResourceAttributeUtils.getFileAttributesByPath(File, Logger, int, boolean) line: 226\r\nPlexusIoResourceAttributeUtils.getFileAttributes(File) line: 171\r\nArchiveEntry.createFileEntry(String, File, int) line: 157\t\r\nJarArchiver(AbstractArchiver).addFile(File, String, int) line: 374\r\nJarArchiver(AbstractArchiver).addFile(File, String) line: 290\r\n{code}\r\n\r\nI can think of two solutions:\r\n\r\n(a) have a disable flag available, if you don't need the attributes but want the speed increase\r\n\r\n(b) run the ls recursively from the root of the project and parse it only once - this would cut down the overhead of forking the ls's significantly\r\n\r\nBeing a Maven plugin/Plexus neophyte I have no idea how to go about implementing either of these.\r\n\r\n\r\n","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=t_kurki","name":"t_kurki","emailAddress":"teppo.kurki@reaktor.fi","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Teppo Kurki","active":true},"created":"2010-12-08T15:04:30.122-0600","updated":"2010-12-08T15:04:30.122-0600"},{"self":"http://jira.codehaus.org/rest/api/2/issue/118942/comment/271636","id":"271636","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=krosenvold","name":"krosenvold","emailAddress":"krosenvold@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=krosenvold&avatarId=11127","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=krosenvold&avatarId=11127","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=krosenvold&avatarId=11127","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=krosenvold&avatarId=11127"},"displayName":"Kristian Rosenvold","active":true},"body":"\"Fixed\" in 05b1968bce1cd5756211a17bcba3eff43430e7f and 05b1968bce1cd5756211a17bcba3eff43430e7f.\r\n\r\nThe second commit contains the \"proper\" fix that uses jdk 1.7 file attributes to solve this issue. The first commit simply does both forks in parallel to reduce overhead.\r\n\r\nUnfortunately this is not going to get that much better, it's the tradeoff between correctness and speed. Te \"good\"  fix will be available by upgrading to jdk 1.7.","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=krosenvold","name":"krosenvold","emailAddress":"krosenvold@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=krosenvold&avatarId=11127","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=krosenvold&avatarId=11127","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=krosenvold&avatarId=11127","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=krosenvold&avatarId=11127"},"displayName":"Kristian Rosenvold","active":true},"created":"2011-06-27T15:46:59.723-0500","updated":"2011-06-27T15:46:59.723-0500"}]},"timeoriginalestimate":null,"aggregatetimespent":null}}