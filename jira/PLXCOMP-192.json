{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"131388","self":"http://jira.codehaus.org/rest/api/latest/issue/131388","key":"PLXCOMP-192","fields":{"progress":{"progress":0,"total":0},"summary":"WarArchiver.setWebxml() does not work correctly on Windows","timetracking":{},"issuetype":{"self":"http://jira.codehaus.org/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"http://jira.codehaus.org/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"customfield_10110":null,"votes":{"self":"http://jira.codehaus.org/rest/api/2/issue/PLXCOMP-192/votes","votes":1,"hasVoted":false},"resolution":{"self":"http://jira.codehaus.org/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"fixVersions":[{"self":"http://jira.codehaus.org/rest/api/2/version/18270","id":"18270","name":"plexus-archiver-2.0.2","archived":false,"released":true,"releaseDate":"2012-01-14"}],"resolutiondate":"2012-01-12T09:58:15.544-0600","customfield_10210":"0.0","timespent":null,"reporter":{"self":"http://jira.codehaus.org/rest/api/2/user?username=dennislundberg","name":"dennislundberg","emailAddress":"dennisl@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Dennis Lundberg","active":true},"aggregatetimeoriginalestimate":null,"customfield_10161":["dennislundberg(dennislundberg)","krosenvold(krosenvold)"],"customfield_10160":null,"updated":"2012-01-12T09:58:15.728-0600","created":"2011-11-09T13:52:34.980-0600","description":"I'm trying to fix MWAR-248 and have found the problem, after some serious digging into the plexus-archiver code.\r\n\r\nThe WAR Plugin begins by creating a WarArchiver to which it adds the webapp directory, using warArchiver.addDirectory(...). This adds the files in the webapp directory as a PlexusIoFileResourceCollection. Each object in the collection is added to the archive as an ArchiveEntry with a target name that is platform dependent. On Windows the contents of the archive looks like this, when printing out each entry's name: \r\n\r\n{noformat}\r\norg\r\norg\\web\r\norg\\web\\app\r\nWEB-INF\r\nWEB-INF\\classes\r\norg\\web\\app\\last-exile.jsp\r\npansit.jsp\r\nWEB-INF\\web.xml\r\n{noformat}\r\n\r\nWhen this is done the WAR Plugin tried to add the web.xml file, if one exists. This is added to the WarArchive as a file.\r\n\r\n*Problem 1*\r\n\r\nWarArchiver.setWebxml() (line 88) will add the file with the target name hard coded to \"WEB-INF/web.xml\". This results in an ArchiveEntry that is different from the one added in the earlier step, for the exact same file.\r\n\r\n*Proposed Solution 1*\r\n\r\nReplace the hard coded file separator with File.separatorChar.\r\n\r\n*Problem 2*\r\n\r\nAbstractArchiver.addFile() (line 362) replaces all '\\' with '/' in the target name. Again this results in an ArchiveEntry that is different than in the earlier step.\r\n\r\n*Proposed solution*\r\n\r\nRemove the line that converts '\\' to '/':\r\n{code}\r\n  destFileName = destFileName.replace( '\\\\', '/' );\r\n{code}\r\n\r\n*Summary*\r\n\r\nThe first solution is a no brainer, but I'm not sure what impact the second one will have. Ideally it would be best to always use Java syntax paths, with '/'. But I haven't figured out how to do this for warArchiver.addDirectory(...).\r\n\r\nI've tried my proposed solution locally on Windows and all tests pass both in plexus archiver and the WAR Plugin. If you approve my proposed solution, I'll conduct more tests, and provide a patch file.\r\n\r\n*Note*\r\n\r\nAll testing and modifications have been done on the plexus-archiver-1.2 tag. I haven't yet tried to upgrading the WAR Plugin to use Plexus Archiver 2.0.1.","priority":{"self":"http://jira.codehaus.org/rest/api/2/priority/3","iconUrl":"http://jira.codehaus.org/images/icons/priorities/major.png","name":"Major","id":"3"},"duedate":null,"issuelinks":[{"id":"30226","self":"http://jira.codehaus.org/rest/api/2/issueLink/30226","type":{"id":"10001","name":"dependent","inward":"is depended upon by","outward":"depends upon","self":"http://jira.codehaus.org/rest/api/2/issueLinkType/10001"},"inwardIssue":{"id":"121613","key":"MWAR-248","self":"http://jira.codehaus.org/rest/api/2/issue/121613","fields":{"summary":"Plugin warns about missing webxml attribute even if one exists","status":{"self":"http://jira.codehaus.org/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"http://jira.codehaus.org/images/icons/statuses/closed.png","name":"Closed","id":"6"},"priority":{"self":"http://jira.codehaus.org/rest/api/2/priority/3","iconUrl":"http://jira.codehaus.org/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"http://jira.codehaus.org/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"http://jira.codehaus.org/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_10163":"94953600","watches":{"self":"http://jira.codehaus.org/rest/api/2/issue/PLXCOMP-192/watchers","watchCount":1,"isWatching":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"subtasks":[],"status":{"self":"http://jira.codehaus.org/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"http://jira.codehaus.org/images/icons/statuses/closed.png","name":"Closed","id":"6"},"customfield_10090":null,"labels":[],"workratio":-1,"assignee":{"self":"http://jira.codehaus.org/rest/api/2/user?username=krosenvold","name":"krosenvold","emailAddress":"krosenvold@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=krosenvold&avatarId=11127","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=krosenvold&avatarId=11127","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=krosenvold&avatarId=11127","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=krosenvold&avatarId=11127"},"displayName":"Kristian Rosenvold","active":true},"attachment":[],"customfield_10221":null,"customfield_10220":null,"customfield_10200":null,"aggregatetimeestimate":null,"customfield_10190":null,"project":{"self":"http://jira.codehaus.org/rest/api/2/project/11440","id":"11440","key":"PLXCOMP","name":"Plexus Components","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/projectavatar?size=xsmall&pid=11440&avatarId=10011","24x24":"http://jira.codehaus.org/secure/projectavatar?size=small&pid=11440&avatarId=10011","32x32":"http://jira.codehaus.org/secure/projectavatar?size=medium&pid=11440&avatarId=10011","48x48":"http://jira.codehaus.org/secure/projectavatar?pid=11440&avatarId=10011"},"projectCategory":{"self":"http://jira.codehaus.org/rest/api/2/projectCategory/10003","id":"10003","description":"various containers","name":"containers"}},"versions":[{"self":"http://jira.codehaus.org/rest/api/2/version/17282","id":"17282","description":"","name":"plexus-archiver-1.2","archived":false,"released":true,"releaseDate":"2010-10-09"},{"self":"http://jira.codehaus.org/rest/api/2/version/17455","id":"17455","description":"","name":"plexus-archiver-2.0","archived":false,"released":true,"releaseDate":"2011-06-27"}],"customfield_10170":null,"environment":"Windows 7\r\nMaven WAR Plugin\r\nPlexus Archiver 1.2 (with local modifications, see below)","timeestimate":null,"customfield_10130":null,"aggregateprogress":{"progress":0,"total":0},"lastViewed":null,"components":[{"self":"http://jira.codehaus.org/rest/api/2/component/12540","id":"12540","name":"plexus-archiver"}],"comment":{"startAt":0,"maxResults":1,"total":1,"comments":[{"self":"http://jira.codehaus.org/rest/api/2/issue/131388/comment/288127","id":"288127","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=krosenvold","name":"krosenvold","emailAddress":"krosenvold@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=krosenvold&avatarId=11127","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=krosenvold&avatarId=11127","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=krosenvold&avatarId=11127","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=krosenvold&avatarId=11127"},"displayName":"Kristian Rosenvold","active":true},"body":"Thanks for an excellent analysis. I wrote a test-case and verified correct operation on both windows and linux.\r\n\r\nUnfortunately the plexus io collections seem to return platform specific separatorChar, which is where all the madness begins, and just propagates up. Through several layers. \"Some day\" we might fix that too ;) \r\n\r\n\r\nFixed in 29cedb1344b1803f6b83c3c7b9a7d924225d028e.\r\n\r\n\r\n","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=krosenvold","name":"krosenvold","emailAddress":"krosenvold@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=krosenvold&avatarId=11127","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=krosenvold&avatarId=11127","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=krosenvold&avatarId=11127","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=krosenvold&avatarId=11127"},"displayName":"Kristian Rosenvold","active":true},"created":"2012-01-12T09:58:15.653-0600","updated":"2012-01-12T09:58:15.653-0600"}]},"timeoriginalestimate":null,"aggregatetimespent":null}}