{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"136951","self":"http://jira.codehaus.org/rest/api/latest/issue/136951","key":"PLXCOMP-203","fields":{"progress":{"progress":0,"total":0},"summary":"Ability to turn off Java7 support","timetracking":{},"issuetype":{"self":"http://jira.codehaus.org/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"http://jira.codehaus.org/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false},"customfield_10110":null,"votes":{"self":"http://jira.codehaus.org/rest/api/2/issue/PLXCOMP-203/votes","votes":0,"hasVoted":false},"resolution":{"self":"http://jira.codehaus.org/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"fixVersions":[{"self":"http://jira.codehaus.org/rest/api/2/version/18796","id":"18796","name":"plexus-io-2.0.5","archived":false,"released":true,"releaseDate":"2012-09-20"}],"resolutiondate":"2012-09-20T15:28:01.434-0500","customfield_10210":"2.0","timespent":null,"reporter":{"self":"http://jira.codehaus.org/rest/api/2/user?username=pipelare","name":"pipelare","emailAddress":"pipelare@gmail.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Alfonso Gonzalez del Riego","active":true},"aggregatetimeoriginalestimate":null,"customfield_10161":["pipelare(pipelare)","krosenvold(krosenvold)"],"customfield_10160":null,"updated":"2012-09-20T15:28:01.847-0500","created":"2012-05-16T13:37:35.149-0500","description":"Plexus IO has the Java7Reflector to use the new NIO methods for finding file attributes (like group ownership). Unfortunately, Java7's API is not perfect, and reading group principals can be really slow if the group is not local (e.g. LDAP). Thus, it would be nice if we could turn off that ability (preferably through a java system property so we don't have to ask for changes in things like the maven-jar-plugin) and fall back to the pre-java7 behavior, which works well with LDAP groups.\r\n\r\nMore details for the curious:\r\nWhen you have PosixFileAttributes for a file and request the group(), java7 calls getgrgid, which can be really slow with non-local groups. If you look at the source for ls in coreutils, for example, they cache the results of getgrgid so they don't have to call it repeatedly. Fixing this in Java7 seems hard, as naive caching would be wrong.","priority":{"self":"http://jira.codehaus.org/rest/api/2/priority/3","iconUrl":"http://jira.codehaus.org/images/icons/priorities/major.png","name":"Major","id":"3"},"duedate":null,"issuelinks":[],"customfield_10163":"73094400","watches":{"self":"http://jira.codehaus.org/rest/api/2/issue/PLXCOMP-203/watchers","watchCount":1,"isWatching":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"subtasks":[],"status":{"self":"http://jira.codehaus.org/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"http://jira.codehaus.org/images/icons/statuses/closed.png","name":"Closed","id":"6"},"customfield_10090":null,"labels":[],"workratio":-1,"assignee":{"self":"http://jira.codehaus.org/rest/api/2/user?username=krosenvold","name":"krosenvold","emailAddress":"krosenvold@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=krosenvold&avatarId=11127","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=krosenvold&avatarId=11127","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=krosenvold&avatarId=11127","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=krosenvold&avatarId=11127"},"displayName":"Kristian Rosenvold","active":true},"attachment":[{"self":"http://jira.codehaus.org/rest/api/2/attachment/59966","id":"59966","filename":"0001-Cache-users-and-groups-in-Java7-support-classes.-Thi.patch","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=pipelare","name":"pipelare","emailAddress":"pipelare@gmail.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Alfonso Gonzalez del Riego","active":true},"created":"2012-05-17T01:25:56.054-0500","size":11813,"mimeType":"text/x-patch","content":"http://jira.codehaus.org/secure/attachment/59966/0001-Cache-users-and-groups-in-Java7-support-classes.-Thi.patch"},{"self":"http://jira.codehaus.org/rest/api/2/attachment/59964","id":"59964","filename":"0001-Cache-users-and-groups-in-Java7-support-classes.-Thi.patch","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=pipelare","name":"pipelare","emailAddress":"pipelare@gmail.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Alfonso Gonzalez del Riego","active":true},"created":"2012-05-16T17:59:03.082-0500","size":11781,"mimeType":"text/x-patch","content":"http://jira.codehaus.org/secure/attachment/59964/0001-Cache-users-and-groups-in-Java7-support-classes.-Thi.patch"}],"customfield_10221":null,"customfield_10220":null,"customfield_10200":null,"aggregatetimeestimate":null,"customfield_10190":null,"project":{"self":"http://jira.codehaus.org/rest/api/2/project/11440","id":"11440","key":"PLXCOMP","name":"Plexus Components","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/projectavatar?size=xsmall&pid=11440&avatarId=10011","24x24":"http://jira.codehaus.org/secure/projectavatar?size=small&pid=11440&avatarId=10011","32x32":"http://jira.codehaus.org/secure/projectavatar?size=medium&pid=11440&avatarId=10011","48x48":"http://jira.codehaus.org/secure/projectavatar?pid=11440&avatarId=10011"},"projectCategory":{"self":"http://jira.codehaus.org/rest/api/2/projectCategory/10003","id":"10003","description":"various containers","name":"containers"}},"versions":[{"self":"http://jira.codehaus.org/rest/api/2/version/17626","id":"17626","description":"","name":"plexus-io-2.0.2","archived":false,"released":true,"releaseDate":"2012-01-14"}],"customfield_10170":null,"environment":"Linux","timeestimate":null,"customfield_10130":null,"aggregateprogress":{"progress":0,"total":0},"lastViewed":null,"components":[{"self":"http://jira.codehaus.org/rest/api/2/component/14319","id":"14319","name":"plexus-io"}],"comment":{"startAt":0,"maxResults":4,"total":4,"comments":[{"self":"http://jira.codehaus.org/rest/api/2/issue/136951/comment/298947","id":"298947","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=pipelare","name":"pipelare","emailAddress":"pipelare@gmail.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Alfonso Gonzalez del Riego","active":true},"body":"As an aside, it is possible to read group data from java7 quickly, but you have to manually cache groups, kind of like:\r\n\r\n{code}\r\nimport java.io.IOException;\r\nimport java.nio.file.FileSystem;\r\nimport java.nio.file.FileSystems;\r\nimport java.nio.file.FileVisitResult;\r\nimport java.nio.file.Files;\r\nimport java.nio.file.Path;\r\nimport java.nio.file.SimpleFileVisitor;\r\nimport java.nio.file.attribute.BasicFileAttributes;\r\nimport java.nio.file.attribute.GroupPrincipal;\r\nimport java.nio.file.attribute.PosixFileAttributeView;\r\nimport java.util.HashMap;\r\nimport java.util.Map;\r\n\r\npublic class FileTest {\r\n    public static void main(String[] args) throws Exception {\r\n        final Map<Integer, GroupPrincipal> groupCache = new HashMap<>();\r\n        final FileSystem fs = FileSystems.getDefault();\r\n        Path path = fs.getPath(args[0]);\r\n        Files.walkFileTree(path, new SimpleFileVisitor<Path>() {\r\n            @Override\r\n            public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException {\r\n                long nanos = System.nanoTime();\r\n                if (attrs.isRegularFile()) {\r\n                    GroupPrincipal group;\r\n                    Integer gid = (Integer)Files.readAttributes(file, \"unix:gid\").get(\"gid\");\r\n                    group = groupCache.get(gid);\r\n                    if (group == null) {\r\n                        group = Files.getFileAttributeView(file, PosixFileAttributeView.class).readAttributes().group();\r\n                        groupCache.put(gid, group);\r\n                    }\r\n                    long duration = System.nanoTime() - nanos;\r\n                    System.out.format(\"%s: %s (%,d)%n\", file, group.getName(), duration);\r\n                }\r\n                return FileVisitResult.CONTINUE;\r\n            }\r\n        });\r\n    }\r\n}\r\n{code}","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=pipelare","name":"pipelare","emailAddress":"pipelare@gmail.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Alfonso Gonzalez del Riego","active":true},"created":"2012-05-16T14:28:22.451-0500","updated":"2012-05-16T14:30:39.095-0500"},{"self":"http://jira.codehaus.org/rest/api/2/issue/136951/comment/298963","id":"298963","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=pipelare","name":"pipelare","emailAddress":"pipelare@gmail.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Alfonso Gonzalez del Riego","active":true},"body":"If I may hijack my own feature request, I have a patch that actually fixes the Java7 support (so no need to configurably turn it off).","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=pipelare","name":"pipelare","emailAddress":"pipelare@gmail.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Alfonso Gonzalez del Riego","active":true},"created":"2012-05-16T17:59:03.085-0500","updated":"2012-05-16T17:59:03.085-0500"},{"self":"http://jira.codehaus.org/rest/api/2/issue/136951/comment/298971","id":"298971","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=pipelare","name":"pipelare","emailAddress":"pipelare@gmail.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Alfonso Gonzalez del Riego","active":true},"body":"My apologies, that last patch was not right. This one works correctly.","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=pipelare","name":"pipelare","emailAddress":"pipelare@gmail.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Alfonso Gonzalez del Riego","active":true},"created":"2012-05-17T01:25:56.065-0500","updated":"2012-05-17T01:25:56.065-0500"},{"self":"http://jira.codehaus.org/rest/api/2/issue/136951/comment/309300","id":"309300","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=krosenvold","name":"krosenvold","emailAddress":"krosenvold@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=krosenvold&avatarId=11127","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=krosenvold&avatarId=11127","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=krosenvold&avatarId=11127","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=krosenvold&avatarId=11127"},"displayName":"Kristian Rosenvold","active":true},"body":"Fixed in da38b3d0966b44d5a980b71038dff593fde2b815, thanks for the patch!\r\n\r\n","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=krosenvold","name":"krosenvold","emailAddress":"krosenvold@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&ownerId=krosenvold&avatarId=11127","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&ownerId=krosenvold&avatarId=11127","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&ownerId=krosenvold&avatarId=11127","48x48":"http://jira.codehaus.org/secure/useravatar?ownerId=krosenvold&avatarId=11127"},"displayName":"Kristian Rosenvold","active":true},"created":"2012-09-20T15:28:01.725-0500","updated":"2012-09-20T15:28:01.725-0500"}]},"timeoriginalestimate":null,"aggregatetimespent":null}}