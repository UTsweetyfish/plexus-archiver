{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"114782","self":"http://jira.codehaus.org/rest/api/latest/issue/114782","key":"PLXCOMP-156","fields":{"progress":{"progress":0,"total":0},"summary":"Poor performance in DirectoryArchiver due to unnecessary native chmod calls","timetracking":{},"issuetype":{"self":"http://jira.codehaus.org/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"http://jira.codehaus.org/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"customfield_10110":null,"votes":{"self":"http://jira.codehaus.org/rest/api/2/issue/PLXCOMP-156/votes","votes":0,"hasVoted":false},"resolution":{"self":"http://jira.codehaus.org/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"fixVersions":[{"self":"http://jira.codehaus.org/rest/api/2/version/17283","id":"17283","description":"","name":"plexus-archiver-1.1","archived":false,"released":true,"releaseDate":"2010-09-28"}],"resolutiondate":"2010-09-27T15:24:16.418-0500","customfield_10210":"0.0","timespent":null,"reporter":{"self":"http://jira.codehaus.org/rest/api/2/user?username=paperino","name":"paperino","emailAddress":"altin@riskfocusinc.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Altin Papa","active":true},"aggregatetimeoriginalestimate":null,"customfield_10161":["paperino(paperino)","olamy(olamy)"],"customfield_10160":null,"updated":"2011-04-02T09:39:20.809-0500","created":"2010-09-07T08:25:22.537-0500","description":"maven-assembly-plugin calls DirectoryArchiver.copyFile( ArchiveEntry entry, String vPath ), which calls\r\n  ArchiveEntryUtils.chmod( outFile, entry.getMode(), getLogger() );\r\nresulting in a native child Process being forked to do a chmod  (on Unix only)\r\n\r\nThe performance impact on a large assembly is enormous: patching DirectoryArchiver to not do this resulted in a performance improvement by more than 5 times.\r\n\r\nSuggestions: \r\n- Avoid this call, at least if the entry.mode has not been set (it's still default)\r\n- Skip the call by default [when creating a dir archive, chances are the execution step/script will take care of perms via 'chmod -R' etc]; provide an argument if callers really need perms to be set here\r\n- Use Java 6 methods to set file perms, when available\r\n\r\nAlso please consider caching the environment in CommandLineUtils (as the JDK does), esp. if retrieving it means a native call (pre-JDK5)","priority":{"self":"http://jira.codehaus.org/rest/api/2/priority/3","iconUrl":"http://jira.codehaus.org/images/icons/priorities/major.png","name":"Major","id":"3"},"duedate":null,"issuelinks":[{"id":"27164","self":"http://jira.codehaus.org/rest/api/2/issueLink/27164","type":{"id":"10001","name":"dependent","inward":"is depended upon by","outward":"depends upon","self":"http://jira.codehaus.org/rest/api/2/issueLinkType/10001"},"inwardIssue":{"id":"114783","key":"MASSEMBLY-499","self":"http://jira.codehaus.org/rest/api/2/issue/114783","fields":{"summary":"Poor performance in DirectoryArchiver due to unnecessary native calls","status":{"self":"http://jira.codehaus.org/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"http://jira.codehaus.org/images/icons/statuses/closed.png","name":"Closed","id":"6"},"priority":{"self":"http://jira.codehaus.org/rest/api/2/priority/3","iconUrl":"http://jira.codehaus.org/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"http://jira.codehaus.org/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"http://jira.codehaus.org/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_10163":"135648000","watches":{"self":"http://jira.codehaus.org/rest/api/2/issue/PLXCOMP-156/watchers","watchCount":1,"isWatching":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"subtasks":[],"status":{"self":"http://jira.codehaus.org/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"http://jira.codehaus.org/images/icons/statuses/closed.png","name":"Closed","id":"6"},"customfield_10090":null,"labels":[],"workratio":-1,"assignee":{"self":"http://jira.codehaus.org/rest/api/2/user?username=olamy","name":"olamy","emailAddress":"olamy@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Olivier Lamy","active":true},"attachment":[],"customfield_10221":null,"customfield_10220":null,"customfield_10200":null,"aggregatetimeestimate":null,"customfield_10190":null,"project":{"self":"http://jira.codehaus.org/rest/api/2/project/11440","id":"11440","key":"PLXCOMP","name":"Plexus Components","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/projectavatar?size=xsmall&pid=11440&avatarId=10011","24x24":"http://jira.codehaus.org/secure/projectavatar?size=small&pid=11440&avatarId=10011","32x32":"http://jira.codehaus.org/secure/projectavatar?size=medium&pid=11440&avatarId=10011","48x48":"http://jira.codehaus.org/secure/projectavatar?pid=11440&avatarId=10011"},"projectCategory":{"self":"http://jira.codehaus.org/rest/api/2/projectCategory/10003","id":"10003","description":"various containers","name":"containers"}},"versions":[{"self":"http://jira.codehaus.org/rest/api/2/version/17284","id":"17284","description":"","name":"plexus-archiver-1.0","archived":false,"released":true,"releaseDate":"2010-04-25"}],"customfield_10170":null,"environment":null,"timeestimate":null,"customfield_10130":null,"aggregateprogress":{"progress":0,"total":0},"lastViewed":null,"components":[{"self":"http://jira.codehaus.org/rest/api/2/component/12540","id":"12540","name":"plexus-archiver"}],"comment":{"startAt":0,"maxResults":8,"total":8,"comments":[{"self":"http://jira.codehaus.org/rest/api/2/issue/114782/comment/234444","id":"234444","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=olamy","name":"olamy","emailAddress":"olamy@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Olivier Lamy","active":true},"body":"you can improve \"a little\" with upgrading to plexus-utils 2.0.5.\r\nWhich doesn't made an uncessary fork to get env var. \r\nBut sure testing if 1.6 methods could do some optims.","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=olamy","name":"olamy","emailAddress":"olamy@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Olivier Lamy","active":true},"created":"2010-09-07T08:35:39.540-0500","updated":"2010-09-07T08:35:39.540-0500"},{"self":"http://jira.codehaus.org/rest/api/2/issue/114782/comment/234453","id":"234453","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=olamy","name":"olamy","emailAddress":"olamy@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Olivier Lamy","active":true},"body":"so using this will prevent having permissions at the three unix level user group all (as currently)\r\nBecause there is only two level in java methods userOnly or all.\r\n{code}\r\nsetWritable(boolean writable, boolean ownerOnly)\r\n{code}","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=olamy","name":"olamy","emailAddress":"olamy@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Olivier Lamy","active":true},"created":"2010-09-07T09:44:59.710-0500","updated":"2010-09-07T09:44:59.710-0500"},{"self":"http://jira.codehaus.org/rest/api/2/issue/114782/comment/234645","id":"234645","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=paperino","name":"paperino","emailAddress":"altin@riskfocusinc.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Altin Papa","active":true},"body":"I see. However, this is a lesser issue. The main thing is to avoid doing a chmod at all, unless really needed/requested by the user.\r\nIn particular, if I am creating a dir archive, rather than an executable jar, it's almost a given that I will have external shell scripts to run it. And therefore will have a chance to set my own perms.\r\n\r\nSo, I would say either skip chmod() by default and provide a flag for callers to really force it, or do a check like this:\r\n if assembly.formats.format=dir or  file/dir Mode not set (= default), skip chmod()\r\n\r\nSimilarly, for Java 6 API, you could check if mode!=default, and 'group' and 'other' are equal, in which case you can use the Java 6 API, else fallback to forking.\r\n\r\nThanks for the quick response, btw.","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=paperino","name":"paperino","emailAddress":"altin@riskfocusinc.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Altin Papa","active":true},"created":"2010-09-08T11:56:29.773-0500","updated":"2010-09-08T11:56:29.773-0500"},{"self":"http://jira.codehaus.org/rest/api/2/issue/114782/comment/234652","id":"234652","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=paperino","name":"paperino","emailAddress":"altin@riskfocusinc.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Altin Papa","active":true},"body":"Also, if the perms do need to be set, and they are specified at the fileSet level, chmod should be run once per dir, using the inclusion pattern on the fileSet definition.\r\n\r\nOr even batched across fileSets, to the extent possible.\r\n\r\nIn real usage, there will be little or no variation between file/dir permission modes within a given archive/assembly run.\r\n\r\nIn our experience, nothing came even close to matching the impact of native calls in assembly/archive performance. ","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=paperino","name":"paperino","emailAddress":"altin@riskfocusinc.com","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Altin Papa","active":true},"created":"2010-09-08T12:43:24.250-0500","updated":"2010-09-08T12:43:24.250-0500"},{"self":"http://jira.codehaus.org/rest/api/2/issue/114782/comment/236431","id":"236431","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=olamy","name":"olamy","emailAddress":"olamy@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Olivier Lamy","active":true},"body":"first commit rev 8770","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=olamy","name":"olamy","emailAddress":"olamy@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Olivier Lamy","active":true},"created":"2010-09-24T17:58:12.570-0500","updated":"2010-09-24T17:58:12.570-0500"},{"self":"http://jira.codehaus.org/rest/api/2/issue/114782/comment/236442","id":"236442","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=olamy","name":"olamy","emailAddress":"olamy@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Olivier Lamy","active":true},"body":"ok so basically it works for user and all.\r\nBut as some junit test group permissions too (ie ZipArchiverTest int logMode = 0640) the result of the test will depend on the current shell umask.","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=olamy","name":"olamy","emailAddress":"olamy@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Olivier Lamy","active":true},"created":"2010-09-25T02:33:28.124-0500","updated":"2010-09-25T02:33:28.124-0500"},{"self":"http://jira.codehaus.org/rest/api/2/issue/114782/comment/236443","id":"236443","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=olamy","name":"olamy","emailAddress":"olamy@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Olivier Lamy","active":true},"body":"jvm chmod use will be activatable with -DuseJvmChmod=true and will work only with >= 1.6 :-)\r\nso use plexus-archiver 1.0.1-SNAPSHOT as a dependency of assembly to try that and use maven with -DuseJvmChmod=true\r\n","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=olamy","name":"olamy","emailAddress":"olamy@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Olivier Lamy","active":true},"created":"2010-09-25T02:37:18.316-0500","updated":"2010-09-25T02:55:33.312-0500"},{"self":"http://jira.codehaus.org/rest/api/2/issue/114782/comment/236635","id":"236635","author":{"self":"http://jira.codehaus.org/rest/api/2/user?username=olamy","name":"olamy","emailAddress":"olamy@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Olivier Lamy","active":true},"body":"rev 8775","updateAuthor":{"self":"http://jira.codehaus.org/rest/api/2/user?username=olamy","name":"olamy","emailAddress":"olamy@apache.org","avatarUrls":{"16x16":"http://jira.codehaus.org/secure/useravatar?size=xsmall&avatarId=10232","24x24":"http://jira.codehaus.org/secure/useravatar?size=small&avatarId=10232","32x32":"http://jira.codehaus.org/secure/useravatar?size=medium&avatarId=10232","48x48":"http://jira.codehaus.org/secure/useravatar?avatarId=10232"},"displayName":"Olivier Lamy","active":true},"created":"2010-09-27T15:24:16.489-0500","updated":"2010-09-27T15:24:16.489-0500"}]},"timeoriginalestimate":null,"aggregatetimespent":null}}